# 编程规范
## TODO/FIXME 规范
**TODO/TBD(to be determined)** 注释一般用来描述已知待改进、待补充的修改点,并且加上作者名称。 
**FIXME** 注释一般用来描述已知缺陷，它们都应该有统一风格，方便文本搜索统一处理。如：  
```c++
// TODO <author-name>: 补充XX处理
// FIXME <author-name>: XX缺陷
```

## 方法参数规范
无论是`controller，service, dao`或是其他的代码，每个方法最多传入3个参数，如果超过`3`个参数，要把参数封装成`javabean`对象

原因:
1. 方便他人调用，降低出错几率。尤其是当参数是同一种类型，仅仅依靠顺序区分，稍有不慎便是灾难性后果，而且排查起来也极其恶心。
2. 保持代码整洁、清晰度。当一个个方法里充斥着一堆堆参数的时候，再坚强的人，也会身心疲惫。

## 注释规范
### 注释的重要性
注释是我们披荆斩棘历经磨难翻越需求这座大山时，留下的踪迹和收获的经验教训，这些宝贵的知识除了证明我们曾经存在过，也提醒着后来的人们殷鉴不远、继往开来。

注释除了说明作用、逻辑之外。还有一个很重要的原因：当业务逻辑过于复杂，代码过于庞大的时候，注释就变成了一道道美化环境、分离与整理逻辑思路的路标。这是很重要的一点，它能有效得帮助我们免于陷入代码与业务逻辑的泥沼之中。

### 注释和代码的一致性
注释并不是越多越好，当注释过多，维护代码的同时，还需要维护注释，不仅变成了一种负担，也与我们当初添加注释的初衷背道而驰。

首先：大家应该通过清晰的逻辑架构，好的变量命名来提高代码可读性；需要的时候，才辅以注释说明。注释是为了帮助阅读者快速读懂代码，所以要从读者的角度出发，按需注释。注释内容要简洁、明了、无二义性，信息全面且不冗余。

其次：无论是修改、复制代码时，都要仔细核对注释内容是否正确。只改代码，不改注释是一种不文明行为，破坏了代码与注释的一致性，会让阅读者迷惑、费解，甚至误解。

### 方法注释
方法要尽量通过方法名自解释，不要写无用、信息冗余的方法头，不要写空有格式的方法头注释。

方法头注释内容可选，但不限于：功能说明、返回值，用法、算法实现等等。尤其是对外的方法接口声明，其注释，应当将重要、有用的信息表达清楚。

# 项目规范
## 代码目录结构
```c++
src                               源码目录
|-- common                            各个项目的通用类库

```

## module包中的javabean命名规范
### javabean的整体要求
- 不得有任何的业务逻辑或者计算
- 基本数据类型必须使用包装类型（Integer, Double、Boolean 等）
- 不允许有任何的默认值
- 每个属性必须添加注释，并且必须使用多行注释。
- 使用 lombok 简化 getter/setter 方法
- 建议对象使用 lombok 的 @Builder ，@NoArgsConstructor，同时使用这两个注解，简化对象构造方法以及set方法。

### 数据对象

### 传输对象（DTO）
- 不能继承自domain
- `DTO`可以继承、组合其他`DTO, VO, BO`等对象
- `DTO`只能用于前端、RPC的请求参数

### 视图对象（VO）
- 不能继承自domain
- `VO`可以继承、组合其他的`DTO, VO, BO`等对象
- `VO`只能用于返回前端、RPC的业务数据封装对象

### 业务对象（BO）
- 不能继承自domain
- `BO`对象只能用于`Service, dao`层, 不得用于`controller`层

# MVC规范
整体分层
- controller层
- service层
- dao层
## controller层规范
1）只允许在 method 上添加 RequestMapping 注解，不允许加在 class 上（为了方便的查找 url，放到 url 不能一次性查找出来）
2）不推荐使用 rest 命名 url， 只能使用 get/post 方法。 url命名规范如下：
`业务模块/子模块/动作`
3）每个方法必须添加 swagger 文档注解 @ApiOperation ，并填写接口描述信息，描述最后必须加上作者信息 @Author 你的名字。
4）controller 负责协同和委派业务，充当路由的角色，每个方法要保持简洁
- 不做任何的业务逻辑操作
- 不做任何的参数、业务校验，参数校验只允许使用@Valid注解做简单的校验
- 不做任何的数据组合、拼装、赋值等操作
5）只能在 controller 层获取当前请求用户，并传递给 service 层。
> 因为获取当前请求用户是从 ThreadLocal 里获取取的，在 service、dao 层极有可能是其他非 request 线程调用，会出现 null 的情况，尽量避免

## service层规范
1）合理拆分service文件，如果业务较大，请拆分为多个 service。如：
- `OrderCreateService` 订单新建业务
- `OrderDeliverService` 订单发货业务
2）谨慎处理`@Transactional`事务注解的使用。
3）需要注意的是：注解 @Transactional 事务在类的内部方法调用是不会生效的
4）service是具体的业务处理逻辑服务层，尽量避免将web层某些参数传递到service中。
- 
## dao层规范
1）所有 Dao 继承自 BaseMapper
2）禁止直接在 mybatis xml 中写死常量，应从 dao 中传入到 xml 中
3）建议不要使用星号 * 代替所有字段

命名规范
- 获取单个对象的方法用 read 做前缀
- 获取多个对象的方法用 list 做前缀。
- 获取统计值的方法用 count 做前缀。
- 插入的方法用 create 做前缀。
- 删除的方法用 remove/delete 做前缀。
- 修改的方法用 update 做前缀。

| 动作  | service   | dao    |
|-----|-----------|--------|
| 增   | create    | insert |
| 删   | delete    | delete |
| 改   | update    | update |
| 查   | read/list | select |

> 建议：dao层方法命名尽量以sql语义命名，避免与业务关联。

### boolean类型的属性命名规范
> 类中布尔类型的变量，都不要加is，否则部分框架解析会引起序列化错误。反例：定义为基本数据类型 Boolean isDeleted；的属性，它的方法也是 isDeleted()，RPC在反向解析的时候，“以为”对应的属性名称是 deleted，导致属性获取不到，进而抛出异常。

`boolean`类型的类属性和数据表字段都统一使用`flag`结尾

## 分页参数
| 名称       | 默认值 | 备注 |
|----------|-----|----|
| pageNum  | 1   |    |
| pageSize | 10  |    |

## 方法命名

## 方法规范
**禁止Service跨域调用DAO**

# API规范

## DAO
| 方法  | 请求      | 备注   |     |
|-----|---------|-----|-----|
| 编码类 | varchar | 100 |     |


# 数据库设计规范

## 命名
- 数据表： 必须带有模块前缀
- 如果命名由多个词汇组成，词汇之间加下划线分割

## 设计
- 通常情况下每张表必须有主键，对于非主键，具有唯一性质的，必须加，唯一索引
- 每张表，每个字段都必须有正确的描述说明，以便快速生成数据字典
- 业务数据表必要时冗余基础信息表的核心字段，如：部门编码、部门名称，需要成对出现在业务数据表中
- 表字段的长度要统一，尤其基础数据在业务数据中的引用，如：部门编码、部门名称，在任何业务数据表中的长度务必保持一致
- 存储过程、自定义函数、视图，以及调度，必须要有详细的注释说明
- 统一入口，统一出口原则：相同意义的数据存储、提取，使用同一过程和方法
- 不要盲目的加入其他索引，根据需要统一加索引

### 字段长度
| 名称   | 数据类型      | 长度  | 默认值               | 备注               |
|------|-----------|-----|-------------------|------------------|
| id   | serial8   |     |                   | 单表自增，自增长度为1      |
| 编码类  | varchar   | 128 |                   |                  |
| 帐号类  | varchar   | 128 |                   | 如email， username |
| 状态类  | int4      |     |                   | 如订单状态            |
| 名称类  | varchar   | 128 |                   | 如产品名             |
| 手机电话 | varchar   | 20  |                   |                  |
| 描述   | varchar   | 500 |                   |                  |
| 资源类  | varchar   | 500 |                   | 如url             |
| 时间类  | timestamp |     | CURRENT_TIMESTAMP |                  |


## 使用规范
- SQL书写采用：关键字大写，表名，列名小写
- 变更数据库必须同步 erm 模型


# Git规范

## Commit message

- feat: 添加新功能
- fix： 修复BUG
- docs： 文档/注释
- style： 代码风格改变但不影响运行结果(代码格式化、空格和空行调整等)
- refactor： 代码重构
- test： 测试
- chore： 依赖更新/配置更新
- ci： 持续集成

## 开发分支
```git
[main] > git checkout dev

[dev] > git add .
[dev] > git commit -am docs: 修改项目说明文档
[dev] > git push origin dev
[dev] > git checkout main

[main] > git merge dev
[main] > git add .
[main] > git commit -am sync: main同步dev
[main] > git push origin main
```

